<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <title>Lesopdrachten week 7</title>
</head>
<body>
<section class="hero is-primary">
    <div class="hero-body">
        <p class="title">
            Overzicht van de lesopdrachten van les 7
        </p>
    </div>
</section>
<section class="section">
    <div class="content">
        <!--Opdracht 1-->
        <h3 class="title is-4">
            Opdracht 1: Cross Site Scripting (XSS, oftewel Javascript injectie)
        </h3>
        <p class="mb-4">
            Voer de volgende code in als naam op de pagina <a href="XSS-form.php" target="_blank">XSS-form.php</a>
        </p>
        <blockquote>
            <code>
                &lt;script&gt;for (let i = 0 ; i < Date.now(); i++) alert("Sir Click Alot")&lt;/script&gt;
            </code>
        </blockquote>
        <p class="mb-4">
            Open <a href="XSS-form.php" target="_blank">XSS-form.php</a>. Op <code>regel 39</code> wordt de naam getoond.
            Door hier gebruik te maken van de functie <code>htmlentities()</code>, zorg je ervoor dat javascript (die
            eventueel in de naam zit) niet uitgevoerd wordt.
        </p>
        <blockquote>
            Pas de <a href="XSS-form.php" target="_blank">XSS-form.php</a> pagina aan zodat deze beveiligd is tegen XSS
        </blockquote>


        <!--Opdracht 2-->
        <h3 class="title is-4">
            Opdracht 2: SQL Injection
        </h3>
        <p class="mb-4">
            Voor deze opdracht maken we gebruik van de <code>users</code> tabel uit de vorige les. Zorg ervoor dat er
            minimaal 2 users in de database staan. Als dat niet zo is, kan je ze via de <a
                href="../../les6/exercises/register.php" target="_blank">register.php</a> pagina <a href="../../les6/exercises" target="_blank">uit de vorige les</a> toevoegen.
        </p>
        <blockquote>
            Bezoek de pagina <a href="http://localhost/PRG02-2023-2024/les7/exercises/SQL-injection.php?id=2" target="_blank">http://localhost/PRG02-2023-2024/les7/exercises/SQL-injection.php?id=2</a>.
            In de link zie je staan <code>id=2</code>. Vervang de 2 door het id van de users die als laatste is toegevoegd
            aan de database.
        </blockquote>
        <p class="mb-4">
            Je ziet nu het profiel van de gebruiker met dat id. Ook kun je in de PHP-pagina de query zien die bij deze pagina
            hoort. Aan het einde van de query zie je dat het nummer van het id geplaatst wordt door middel van een variabele.
            We gaan nu de query be誰nvloeden door achter het '=' teken een andere invoer te doen.
        </p>
        <blockquote>
            Zet achter het '=' teken een willekeurig id (bijv. 4) en daarna de tekst <code> OR 1 = 1</code>.
            Je krijgt dan de volgende link:
             <a href="http://localhost/PRG02-2023-2024/les7/exercises/SQL-injection.php?id=4%27%20OR%20%271%27=%271" target="_blank">http://localhost/PRG02-2023-2024/les7/exercises/SQL-injection.php?id=4' OR '1'='1</a>.
        </blockquote>
        <p class="mb-4">
            Je zult nu zien dat je altijd de eerste user uit de database te zien krijgt. Dit komt omdat we de SQL query
            be誰nvloedt hebben. De query <code>SELECT * FROM users WHERE id=2</code> haalt een specifieke user op uit de
            database. Maar door de toevoeging <code>OR 1 = 1</code>, wordt de query <code>SELECT * FROM users WHERE id=2 OR 1 = 1</code>.
            Er staat nu: "Selecteer een gebruiker als zijn id = 2 of als 1 = 1" en dat laatste is altijd waar. Hierdoor
            worden alle users geselecteerd. De code <code>$user = mysqli_fetch_assoc($result);</code> kiest vervolgens
            altijd de eerste gebruiker.
        </p>
        <blockquote>
            Verder in de PHP-pagina de check van het aantal rijen in het resultaat. Na de SQL-query moet er precies 1 rij terugkomen.
            Bezoek daarna nogmaals bovenstaande link.
        </blockquote>
        <p>
            Je ziet nu dat de eerste user niet wordt opgehaald. Toch is deze beveiliging nog niet voldoende. Om er zeker van
            te zijn dat de query die uitgevoerd wordt niet be誰nvloed kan worden door een bezoeker, gaan we de input (vanuit de
            URL) beveiligen. We willen voorkomen die iemand <code>' '</code> kan gebruiken zodat de query anders wordt.
            Dit doen we met de functie <code>mysqli_escape_string()</code>, zie <a href="https://www.php.net/manual/en/mysqli.real-escape-string.php" target="_blank">PHP.net</a>
        </p>
        <blockquote>
            Beveilig nu het id (dat binnenkomt via de GET-methode) tegen SQL Injection door gebruik te maken van de
            functie <code>mysqli_escape_string()</code>
        </blockquote>

        <!--Opdracht 3-->
        <h3 class="title is-4">
            Opdracht 3: Joins
        </h3>
        <p class="mb-4">
            In deze opdracht ga je een zoekopdracht uitvoeren die in twee verschillende tabellen zoekt. Momenteel heb je al een tabel met <code>albums</code> met daarin de kolom <code>artist</code>, waarin de naam van een artist staat opgeslagen. Het is echter een goed idee om de artists in een eigen tabel op te slaan, zodat je eventueel meer informatie over de artist kan opslaan en ook andere entiteiten kan koppelen. Je zult hier eerst de database klaar voor moeten maken, voordat je een JOIN-query kan uitvoeren.
        </p>
        <blockquote>
            Voer de volgende stappen uit in de database via phpMyAdmin:
            <ol>
                <li>Voeg aan de tabel <code>albums</code> de kolom <code>artist_id</code> toe. Dit moet van type <code>int</code> zijn met als lengte <code>11</code> en als attribuut <code>UNSIGNED</code>.</li>
                <li>
                    Maak een nieuwe tabel aan met de naam <code>artists</code> en voeg de volgende kolommen toe:
                    <ul>
                        <li>id (type <code>int</code> met lengte <code>11</code> en attribuut <code>UNSIGNED</code>)</li>
                        <li>name (type <code>varchar</code> met lengte <code>255</code>)</li>
                    </ul>
                </li>
                <li>Importeer in phpMyAdmin het bestand <a href="./includes/les7-import.sql" download>les7/exercises/includes/les7-import.sql</a>. Hiermee worden de artiesten waar je de afgelopen lessen mee hebt gewerkt ge誰mporteerd. Ook wordt er een nieuw album toegevoegd van Adele.</li>
                <li>Koppel nu handmatig ieder album aan bijbehorende artiest. Bijvoorbeeld: het album <code>Harry's House</code> is van de artist <code>Harry Styles</code>, die id <code>9</code> heeft.</code>
                    <br>
                    (hint: in de albums-tabel staat nog de kolom <code>artist</code>, waardoor je weet welke artist bij welk album hoort)</li>
                <li>Verwijder tot slot in de tabel <code>albums</code> de kolom <code>artist</code>.</li>
            </ol>
        </blockquote>
        <p class="mb-4">
            De database is nu gereed en je kan gaan oefenen met JOIN-queries. Voer de volgende queries uit in phpMyAdmin:
        </p>
        <blockquote>
            <ol>
                <li>Selecteer alle albums met bijbehorende artiest</li>
                <li>Selecteer alle albums met bijbehorende artiest, gesorteerd op albumnaam</li>
                <li>Selecteer alle albums van de artiest <code>Adele</code></li>
                <li>Selecteer alle albums en toon alleen de albumnaam en artiestennaam</li>
            </ol>
        </blockquote>
    </div>
</section>
</body>
</html>